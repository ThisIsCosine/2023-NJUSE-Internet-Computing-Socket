# 基于Java原生Socket API的应用——基于UTP的可靠传输
## 一、明确任务
### 作业要求（来自moodle）
主题2：基于 UDP 或 Raw Socket 实现一种可靠的传输层协议（STP）

说明：

1. 使用原生Java Socket API编写

2. 功能要求如下：

	2.1 使用类似TCP的handshake机制建立和断开连接

	2.2 单工，连接分发送方和接收方，接收方除必要的控制报文外不应发送数据报文，发送的数据应是字节流而非字符流

	2.3 需能配置STP报文的最大分段大小（MSS）

	2.4 传输按固定窗口方式进行，只有当窗口中每个数据包都确认传达，才可发送下一个窗口的数据包，最大窗口大小MWS需能配置，可逐包确认（不必如TCP中只确认连续数据包的最后一个可用数据包）

	2.5 需模拟数据包丢失、乱序、超时、出错的情况（如根据概率随机“丢失”数据包）

	2.6 需模拟确认包丢失、乱序、超时的情况

### 简单明确
#### 1、使用原生Java Socket API编写 
这里我们肯定是使用     **Java.net.DatagramSocket** ,即使用UDP，但我们知道UTP是一种传输层不可靠的协议。包中主要的两个类是DatagramServer和DatagramPacket，在client和server之间进行报文DatagramPacket的传递，而并不是流的传递。因此，我们需要重新构建一个新的类 ***STPPacket***（我简单想出来的类名），用来在socket之间传递包含更多信息的报文，以建立可靠的传输。与此同时，我们也要构建一个新的Socket类（这里就称为 ***STPSocket***吧）用来处理这些多出来的信息。
#### 2、功能要求
##### 2.1 使用类似TCP的handshake机制建立和断开连接
这个具体过程我们可以参照 ***TCP的建立连接三次握手机制，和释放连接四次握手机制***，在client和server的STPSocket之间传递 ***只包含控制信息*** 的STPPacket，使得两个socket之间可以建立连接，并close连接。
##### 2.2  单工，连接分发送方和接收方，接收方除必要的控制报文外不应发送数据报文，发送的数据应是字节流而非字符流
单工，连接分发送方和接收方，接收方除必要的控制报文外不应发送数据报文——这句要求实际上减少了作业难度（有但不多）。字节流意味着我们应该在STPPacket中传递byte[],而不是String，这也容易理解。
##### 2.3 需能配置STP报文的最大分段大小（MSS）
MSS具体意义体现在TCP的报文中，大家可以在lf老师的PPT中寻找其意思。我们要做的就是在STPSocket中添加API配置MSS，并且使其在传递STPPacket时发挥合理的作用。
##### 2.4 传输按固定窗口方式进行，只有当窗口中每个数据包都确认传达，才可发送下一个窗口的数据包，最大窗口大小MWS需能配置，可逐包确认（不必如TCP中只确认连续数据包的最后一个可用数据包）
固定窗口的方法大家参见lf老师的PPT，这实际上也是虚拟的窗口，我们要模仿其作用（逐STPPacket确认，窗口移动）。这其中免不了在STPPacket中添加更多的量，如ACK，squ，ack等（这其实就是让我们用Packet的方式实现TCP而不是Java API给的流的方式）
可逐包确认（不必如TCP中只确认连续数据包的最后一个可用数据包）——这个说明也减小了作业难度
##### 2.5 需模拟数据包丢失、乱序、超时、出错的情况（如根据概率随机“丢失”数据包）
我们已经使用了滑动窗口的可靠传输方法，因此我们应该严格按照TCP滑动窗口的要求实现一系列错误的处理。我们当然要在STPSocket.java和STPPacket.java之外写出测试类STPTset.java，用于测试我们所构建的API。
##### 2.6 需模拟确认包丢失、乱序、超时的情况
同上

### ***大家请仔细阅读lf老师传输层，Socket PPT的全部内容（尤其是TCP内容，这是我们的目标，而UDP是我们的基础），还建议至少阅读runoob对于Java原生Socket API的介绍（moodle上的连接）当然最好是阅读oracle啦~~~*** 

### 团队协作 
#### 分工
我认为至少有一人需要再最后书写测试的函数，其他四人承担构建STP API的任务。  
***2.1的建立和释放连接的任务需要一人***  
***2.2 ~ 2.4 需要一人（或两人），目前不清楚建立滑动窗口的工作量***
***2.5 ~ 2.6 需要两人（或一人）***  
***3 撰写测试函数需要一人（即模拟传输出错情况）***  
具体分工我们今日计网实验时讨论
#### 协作方式
##### 1、相对于使用微信协作，我们可尝试使用git和github
##### 2、每人完成自己的任务前需要在自己完成的类中用main函数q确认所写的code无明显bug
##### 3、每人任务时需要慎重命名变量和函数，有必要时请写注释，增加代码的可理解性
##### 4、每人完成任务后需要撰写基本的README.md文件